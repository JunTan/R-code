---
title: "E-project"
output: html_document
Authors: Jun Tan (SID:26370084)   Peirang Xu (SID:25117973)
---

Step 1: DATA WRANGLING

Merging dataset1 and dataset2: (Peirang Xu)

```{r}
#2016 Voting Data
mydata1 = read.csv("http://www.stat.berkeley.edu/users/nolan/data/voteProject/2016_US_County_Level_Presidential_Results.csv")
mydata1 = as.data.frame(mydata1)
mydata1$state_names = state.name[match(mydata1$state_abbr, state.abb)]
mydata1 =mydata1[,c("state_names","county_name","votes_dem","per_dem","votes_gop","per_gop")]
colnames(mydata1) = c("state_names","county_name","vote_count_dem16","vote_percent_dem16","vote_count_gop16","vote_percent_gop16")
mydata1 = data.frame(lapply(mydata1, as.character), stringsAsFactors = FALSE)
mydata1$county_name = gsub("County|city|City","", mydata1$county_name)
mydata1$county_name = sub(" ", "", mydata1$county_name)

#2012 Voting Data
require(XML)
Names = scan("http://www.stat.berkeley.edu/users/nolan/data/voteProject/countyVotes2012/stateNames.txt", character())
state_names = Names[c(-1, -3)]
urls = paste("http://www.stat.berkeley.edu/~nolan/data/voteProject/countyVotes2012/", state_names ,".xml", sep = "")

vtDoc <- list(0)
vtRoot <- list(0)
mydata2 = for(i in 1:length(urls)){
  vtDoc[[i]] = xmlParse(urls[i])
  vtRoot[[i]] = xmlRoot(vtDoc[[i]])
}
getData <- function(x) {
  county_name = xpathSApply(x, '//th[@class = "results-county"]/text()',xmlValue)[-1]
  vote_count_gop12 = xpathSApply(x, '//tr[@class = "party-republican race-winner" or @class = "party-republican"]/td[@class ="results-popular"]',xmlValue)
  vote_percent_gop12 = xpathSApply(x, '//tr[@class = "party-republican race-winner" or @class = "party-republican"]/td[@class = "results-percentage"]',xmlValue) 
  vote_count_dem12 = xpathSApply(x, '//tr[@class = "party-democrat" or @class="party-democrat race-winner"]/td[@class ="results-popular"]',xmlValue)
  vote_percent_dem12 = xpathSApply(x, '//tr[@class = "party-democrat" or @class ="party-democrat race-winner"]/td[@class = "results-percentage"]', xmlValue)
  df_col <- data.frame(county_name, vote_count_gop12, vote_percent_gop12, vote_count_dem12, vote_percent_dem12)
  return(df_col)
}
getData2 = lapply(vtRoot, getData)
rows = sapply(getData2, nrow)
state_names = as.character(rep(state.name, rows))
getData2 = do.call(rbind, getData2)
mydata2 = cbind(state_names, getData2)
mydata2 = data.frame(lapply(mydata2, as.character), stringsAsFactors = FALSE)
mydata2$county_name = sub(" ", "", mydata2$county_name)

#merge two dataframe
data1 = merge(mydata1, mydata2, by = c("state_names", "county_name"), all = TRUE)

data1
```

Merging data1 and dataset3: (Qing Guo)

```{r}
data2 = 

```

Merging data2 and dataset4: (Dennis)

```{r}
data3 = 

```

Merging data3 and dataset5: (Jun Tan)

```{r}
B01003 = read.csv(file="http://www.stat.berkeley.edu/~nolan/data/voteProject/census2010/B01003.csv",head=TRUE,sep=",")
B01003 = B01003[c(-1,-2)]

```

```{r}
# data process for B01003

# Split county names and state names
county_states = sapply(B01003$GEO.display.label, as.character)
county_states = county_states[!is.na(county_states)]
county_states = strsplit(county_states, ",")
B01003$county_name = sapply(county_states, function(x) x[1])
B01003$state_name = sapply(county_states, function(x) x[2])

# Rearrange the data frame, each county-state pair in a row with population stats
col_names =  c("county_name", "state_name", "POPGROUP.display.label", "HD01_VD01", "HD02_VD01")
B01003_popgroup1 = B01003[B01003$POPGROUP.id == 1, col_names]
B01003_popgroup2 = B01003[B01003$POPGROUP.id == 2, col_names]
B01003_popgroup4 = B01003[B01003$POPGROUP.id == 4, col_names]

# Merge different stats
B01003_popgroup1_2 = merge(x = B01003_popgroup1, y = B01003_popgroup2, by.x = c("county_name", "state_name"), by.y = c("county_name", "state_name"), all.x = TRUE)
filter = sapply(B01003_popgroup1_2$county_name, is.na)
B01003_popgroup1_2 = B01003_popgroup1_2[!filter,]

B01003_clean = merge(x = B01003_popgroup1_2, y = B01003_popgroup4, by.x = c("county_name", "state_name"), by.y = c("county_name", "state_name"), all.x = TRUE)
filter = sapply(B01003_clean$county_name, is.na)
B01003_clean= B01003_clean[!filter,]

# Cleant the final dataframe
B01003_clean = B01003_clean[c("county_name", "state_name", "HD01_VD01.x", "HD02_VD01.x", "HD01_VD01.y", "HD02_VD01.y", "HD01_VD01", "HD02_VD01")]
colnames(B01003_clean) = c("county_name", "state_name", "total population", "Margin of Error-total", "white population", "Margin of Error-white", "black population", "Margin of Error-black")
#data4 = 

```

Merging data4 and dataset6: (Gong Ze)

```{r}
big_data = 

```

Step 2: EXPLORATION (Qing Guo, Peirang Xu)

```{r}

```

Step 3: MAP MAKING (Qing Guo, Peirang Xu)
```{r}

```

Step 4: MODELING (Jun Tan, Dennis, Gong Ze)
```{r}

```
