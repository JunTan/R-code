---
title: "E-project"
output: html_document
Authors: Jun Tan   Peirang Xu (SID:25117973)
---

Step 1: DATA WRANGLING

Merging dataset1 and dataset2: (Peirang Xu)

```{r}
#2016 Voting Data
mydata1 = read.csv("http://www.stat.berkeley.edu/users/nolan/data/voteProject/2016_US_County_Level_Presidential_Results.csv")
mydata1 = as.data.frame(mydata1)
mydata1 = mydata1[, c("state_abbr","county_name","votes_dem","per_dem","votes_gop","per_gop")]
mydata1$state_names = state.name[match(mydata1$state_abbr, state.abb)]
colnames(mydata1) = c("state_abbr","county_name","votes_dem16","per_dem16","votes_gop16","per_gop16", "state_names")
mydata1 = data.frame(lapply(mydata1, as.character), stringsAsFactors = FALSE)

#2012 Voting Data
require(XML)
Names = scan("http://www.stat.berkeley.edu/users/nolan/data/voteProject/countyVotes2012/stateNames.txt", character())
state_names = Names[c(-1, -3)]
urls = paste("http://www.stat.berkeley.edu/~nolan/data/voteProject/countyVotes2012/", state_names ,".xml", sep = "")

vtDoc <- list(0)
vtRoot <- list(0)
mydata2 = for(i in 1:length(urls)){
  vtDoc[[i]] = xmlParse(urls[i])
  vtRoot[[i]] = xmlRoot(vtDoc[[i]])
}
getData <- function(x) {
  county_name = xpathSApply(x, '//th[@class = "results-county"]/text()',xmlValue)[-1]
  votes_gop12 = xpathSApply(x, '//tr[@class = "party-republican race-winner" or @class = "party-republican"]/td[@class ="results-popular"]',xmlValue)
  per_gop12 = xpathSApply(x, '//tr[@class = "party-republican race-winner" or @class = "party-republican"]/td[@class = "results-percentage"]',xmlValue) 
  votes_dem12 = xpathSApply(x, '//tr[@class = "party-democrat" or @class="party-democrat race-winner"]/td[@class ="results-popular"]',xmlValue)
  per_dem12 = xpathSApply(x, '//tr[@class = "party-democrat" or @class ="party-democrat race-winner"]/td[@class = "results-percentage"]', xmlValue)
  df_col <- data.frame(county_name, votes_gop12, per_gop12, votes_dem12, per_dem12)
  return(df_col)
}
getData2 = lapply(vtRoot, getData)
rows = sapply(getData2, nrow)
state_names = as.character(rep(state.name, rows))
getData2 = do.call(rbind, getData2)
getData2$county_name = paste(getData2$county_name, "County")
mydata2 = cbind(state_names, getData2)
mydata2 = data.frame(lapply(mydata2, as.character), stringsAsFactors = FALSE)

#merge two dataframe
d2_county_name = mydata2$county_name
mydata2$county_name = sub("  ", " ", d2_county_name)
data1 = merge(mydata1, mydata2, by.x = c("county_name", "state_names"), by.y = c("county_name", "state_names"))
```

Merging data1 and dataset3: (Qing Guo)

```{r}
data2 = 

```

Merging data2 and dataset4: (Dennis)

```{r}
data3 = 

```

Merging data3 and dataset5: (Jun Tan)

```{r}
data4 = 

```

Merging data4 and dataset6: (Gong Ze)

```{r}
big_data = 

```

Step 2: EXPLORATION (Qing Guo, Peirang Xu)

```{r}

```

Step 3: MAP MAKING (Qing Guo, Peirang Xu)
```{r}

```

Step 4: MODELING (Jun Tan, Dennis, Gong Ze)
```{r}

```
